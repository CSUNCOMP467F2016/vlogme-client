<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/demo-pages.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">

<dom-module id="vlogme-response-list">

  <template>

    <app-location route="{{route}}"></app-location>

    <style>

      :host {
        display: block;
        @apply(--layout-vertical);
      }

      paper-toolbar {
        --paper-toolbar-background: var(--vlogme-color-alt, gray);
      }

      paper-listbox {
        @apply(--layout-self-stretch);
      }

      @media (min-width: 700px) {

        iron-scroll-threshold {
          @apply(--layout-flex);
          @apply(--layout-scroll);
        }

      }

    </style>

    <paper-toolbar>
      <div>Responses</div>
    </paper-toolbar>

    <iron-scroll-threshold id="scroll" on-lower-threshold="loadMoreData">
      <paper-listbox id="responses-listbox" tabindex="-1">
        <template is="dom-repeat" items="[[responses]]" as="item">
          <paper-icon-item tabindex="-1" role="none" data-item="[[item]]">
            <iron-icon icon="av:play-circle-filled" item-icon></iron-icon>
            <paper-item-body two-line>
              <div>[[item.title]]</div>
              <div secondary>[[item.duration]]</div>
            </paper-item-body>
          </paper-icon-item>
        </template>
      </paper-listbox>
    </iron-scroll-threshold>

    <paper-button on-click="loadMoreData">Load More&hellip;</paper-button>

  </template>

  <script>
    Polymer({
      is: 'vlogme-response-list',
      select_event_to_item: function(ev) {
        return ev.detail.item.dataItem;
      },
      navigate_to: function(item) {
        this.set('route.path', '/watch/' + item.id);
      },
      ready: function() {
        var list = this.list = this.$['responses-listbox'];
        this.select_cb = this.select_cb || function(e) {
          var item = this.select_event_to_item(e);
          this.navigate_to(item);
          return true;
        }.bind(this);
      },
      attached: function() {
        this.list.addEventListener('iron-select', this.select_cb);
      },
      detached: function() {
        this.list.removeEventListener('iron-select', this.select_cb);
      },
      loadMoreData: function() {
        var scroll = this.$.scroll;
        var item = {
          title: 'First Response',
          duration: '2:34'
        };
        function f() {
          scroll.clearTriggers();
          for (var i = 0; i < 2; i++)
            this.push('responses', item);
        }
        setTimeout(f.bind(this), 500);
      },
      properties: {
        video_title: {
          type: String,
          value: 'Some Video'
        },
        responses: {
          type: Array,
          value: [
            {
              id: '8122cc49-9724-4429-bf73-91ec972b20f0',
              title: 'First Response',
              duration: '2:34'
            },
            {
              id: '48e6fcba-1ebc-4536-8491-b69585d94428',
              title: 'Second Response',
              duration: '22:45'
            }
          ]
        }
      }
    });
  </script>

</dom-module>
