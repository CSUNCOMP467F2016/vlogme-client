<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">


<style>
  @import url("/bower_components/video.js/dist/video-js.min.css");
  @import url("/bower_components/videojs-marker/dist/videojs.markers.min.css");
</style>
<script src="../bower_components/jquery/dist/jquery.js"></script>
<script src="../bower_components/dash-js/dist/dash.all.min.js"></script>
<script src="../bower_components/video.js/dist/video.min.js"></script>
<script src="../bower_components/dash-js/contrib/videojs/videojs-dash.min.js"></script>
<script src="../bower_components/videojs-marker/dist/videojs-markers.min.js"></script>
<script src="../bower_components/videojs-marker/dist/videojs-markers.js"></script>
<!-- <script src="/bower_components/videojs-contrib-dash/dist/videojs-dash.min.js"></script> -->

<dom-module id="vlogme-player">

  <template>

    <style>

      :host {
        display: block;
        @apply(--layout-vertical);
      }

      paper-toolbar {
        --paper-toolbar-background: var(--vlogme-color-alt, gray);
      }

      #video-element {
        @apply(--layout-flex);
        @apply(--layout-self-stretch);
        @apply(--layout-center-center);
      }

      .vjs-fluid {
        padding: 0;
      }

      .video-js{
        font-size: 10px;
        color: #fff;
      }
      video{
        border: 2px solid black;
        height: 267px;
        width: 640px;
      }
      .video-js .vjs-control-bar {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
      }
      .vjs-default-skin .vjs-big-play-button {
        font-size: 3em;
        line-height: 1.5em;
        height: 1.5em;
        width: 3em;
        border: 0.06666em solid #fff;
        border-radius: 0.3em;
        left: 0.5em;
        top: 0.5em;
      }
      .video-js .vjs-control-bar,
      .video-js .vjs-big-play-button,
      .video-js .vjs-menu-button .vjs-menu-content {
        background-color: #2B333F;
        background-color: rgba(43, 51, 63, 0.7);
      }
      .video-js .vjs-slider {
        background-color: #73859f;
        background-color: rgba(115, 133, 159, 0.5);
      }

      .video-js .vjs-volume-level,
      .video-js .vjs-play-progress,
      .video-js .vjs-slider-bar {
        background: #fff;
      }

      .video-js .vjs-load-progress {
        background: rgba(115, 133, 159, 0.5);
      }

      @media(max-width: 699px) {
        :host {
          min-height: 320px;
        }
      }

    </style>

    <app-location route="{{route}}"></app-location>
    <app-route
      route="{{route}}"
      pattern="/watch/:video"
      data="{{player_route_data}}">
    </app-route>

    <paper-toolbar>
      <div>[[video_title]]</div>
    </paper-toolbar>

    <video id="video-element"
      class="video-js vjs-default-skin vjs-fluid"
      src="{{video_uri}}" controls autoplay preload="auto" width="640px" height="267px"
    data-setup="{
      'aspectRatio':'640:267',
      'playbackRates':[1, 1.5, 2]
    }">
    </video>

  </template>

  <script>
    Polymer({
      is: 'vlogme-player',
      observers: [
        '_route_changed(route.*)',
        '_view_changed(player_route_data.video)'
      ],
      ready: function() {
        var video = this.video = this.$$('#video-element');
        //this.$$('#scroll').hide();
        this.scopeSubtree(video, true);
      },
      attached: function() {
        var refresh_interval = 5000; //Interval at which player checks for Responses in ms
        var player = this.player = videojs(this.video);
        player.markers({
          markerStyle: {
            'width': '7px',
            'border': '30%',
            'background-color': 'red'
          },
          markerTip: {
            display: true,
            text: function (marker) {
              return "Comments: " + marker.text;
            },
            time: function (marker) {
              return marker.time;
            }
          },
          breakOverlay: {
            display: false,
            displayTime: 3,
            style: {
              'width': '100%',
              'height': '20%',
              'background-color': 'rgba(0,0,0,0.7)',
              'color': 'white',
              'font-size': '17px'
            },
            text: function (marker) {
              return "Comment Overlay: " + marker.overlayText;
            }
          },
          onMarkerClick: function (marker) {

          },
          onMarkerReached: function (marker) {
                player.pause();
                $('#scroll').show("fast");
          },
          markers: [{
            time: 30,
            text: "marker",
            overlayText: 'overlay',
            class: 'custom-marker'
          }]
        })
      },
      detached: function() {
        this.player.dispose();
      },
      _route_changed: function(r) {
        console.log('route changed to ', r);
      },
      _view_changed: function(view) {
        console.log('view changed to ', view);
      },
      properties: {
        video_title: {
          type: String,
          value: 'Un Chien Andalou (clip)'
        },
        video_uri: {
          type: String,
          value: '/video.mp4'
        }
      },

      get_player: function(){ //returns a reference to the Player
        return this.player;
      }
    });
  </script>

</dom-module>
